<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Generador de Prompt Maestro ‚Äî IngLucas</title>
  <meta name="description" content="Herramienta para generar un Prompt Maestro que integra contenido en una plantilla base sin romper la estructura del sitio."/>
  <style>
    /* ==========================
       Estilos b√°sicos (scope ILH)
       ========================== */
    :root{
      --bg:#0b1220; --card:#111a2b; --ink:#e8f0ff; --muted:#9bb0d1; --accent:#4cc9f0; --ok:#2bd164; --bad:#ff5964; --border:#23314e;
    }
    [data-scope="ilh"]{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial; color:var(--ink); background:var(--bg); min-height:100dvh; padding:24px}
    .ilh-wrap{max-width:1100px; margin:auto}
    h1{margin:0 0 8px}
    p.ilh-sub{color:var(--muted); margin-top:0}
    .ilh-grid{display:grid; gap:16px}
    @media(min-width:900px){ .ilh-grid{grid-template-columns:1fr 1fr} }
    .ilh-card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px}
    .ilh-full{grid-column:1/-1}
    label{font-weight:600; display:block; margin:.4rem 0}
    input[type="text"], input[type="search"], select, textarea{
      width:100%; padding:10px 12px; background:#0e1728; color:var(--ink); border:1px solid var(--border); border-radius:10px; font-family:ui-monospace, Menlo, Consolas, monospace
    }
    textarea{min-height:160px; resize:vertical}
    .ilh-row{display:flex; gap:12px; flex-wrap:wrap}
    .ilh-row > *{flex:1}
    .ilh-checks{display:grid; gap:8px}
    .ilh-checks label{display:flex; gap:10px; align-items:flex-start; font-weight:500}
    .ilh-badges{display:flex; gap:8px; flex-wrap:wrap; margin-top:8px}
    .ilh-badge{background:#0e1728; border:1px solid var(--border); color:var(--muted); border-radius:999px; padding:4px 10px; font-size:.85rem}
    .ilh-actions{display:flex; gap:12px; flex-wrap:wrap}
    button{
      background:var(--accent); color:#071120; border:0; border-radius:10px; padding:12px 16px; font-weight:700; cursor:pointer
    }
    button.secondary{background:#16233a; color:var(--ink); border:1px solid var(--border)}
    button.ok{background:var(--ok); color:#06210f}
    .ilh-hint{font-size:.9rem; color:var(--muted)}
    .ilh-preview{background:#0a1426; border:1px dashed var(--border); border-radius:14px; padding:12px; white-space:pre-wrap; overflow:auto; max-height:50vh}
    .ilh-inline{display:inline-flex; gap:10px; align-items:center}
    .ilh-chip{background:#12203a; color:var(--muted); padding:4px 8px; border-radius:8px; font-size:.8rem}
    .ilh-note{border-left:3px solid var(--accent); padding-left:10px; color:var(--muted); font-size:.95rem}
    .ilh-ok{color:var(--ok); font-weight:700}
    .ilh-warn{color:#ffd166; font-weight:700}
  </style>
</head>
<body>
<main class="ilh-wrap" data-scope="ilh">
  <header class="ilh-full">
    <h1>üß© Generador de Prompt Maestro</h1>
    <p class="ilh-sub">Integra contenido en tu plantilla sin romper header/drawer/utterances/footer/cookies. Marca tus reglas, genera, copia y a correr.</p>
  </header>

  <!-- ===============================
       1) Plantilla y contenido base
       =============================== -->
  <section class="ilh-card ilh-full">
    <h2>1) Entradas base</h2>
    <div class="ilh-grid">
      <div class="ilh-card">
        <label for="template-input">Plantilla HTML Base</label>
        <textarea id="template-input" placeholder="Pega aqu√≠ tu plantilla HTML completa..."></textarea>
        <p class="ilh-hint">ES: La plantilla debe contener la zona donde se insertar√° el contenido. | EN: Template must include the insertion zone.</p>
      </div>
      <div class="ilh-card">
        <label for="content-input">Contenido del Proyecto (HTML o Texto)</label>
        <textarea id="content-input" placeholder="Pega aqu√≠ tu contenido HTML o Texto..."></textarea>

        <div class="ilh-row" style="margin-top:8px">
          <div>
            <label for="content-type">Tipo de Contenido</label>
            <select id="content-type">
              <option value="html" selected>HTML</option>
              <option value="text">Texto (convertir a HTML limpio)</option>
            </select>
          </div>
          <div>
            <label for="structure">¬øEstructura acad√©mica?</label>
            <select id="structure">
              <option value="yes" selected>S√≠</option>
              <option value="no">No</option>
            </select>
          </div>
          <div>
            <label for="insertion-selector">Selector de inserci√≥n</label>
            <input id="insertion-selector" type="text" placeholder='Ej.: section.pane' value="section.pane"/>
            <p class="ilh-hint">ES: Selector CSS exacto donde se permite modificar. | EN: Exact CSS selector for allowed changes.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===============================
       2) Contexto del encargo
       =============================== -->
  <section class="ilh-card ilh-full">
    <h2>2) Contexto del encargo</h2>
    <div class="ilh-grid">
      <div class="ilh-card">
        <label for="goal">Objetivo del prompt</label>
        <input id="goal" type="text" placeholder="Ej.: Integrar un proyecto HTML en la plantilla sin romper el layout"/>
        <label for="audience">Audiencia</label>
        <input id="audience" type="text" placeholder="Ej.: Usuarios no t√©cnicos de la web, equipo acad√©mico, etc."/>
        <div class="ilh-row">
          <div>
            <label for="tone">Tono/Estilo</label>
            <select id="tone">
              <option>Formal docente</option>
              <option selected>Directo y t√©cnico</option>
              <option>Marketing persuasivo</option>
              <option>Neutro</option>
            </select>
          </div>
          <div>
            <label for="format">Formato de salida</label>
            <select id="format">
              <option selected>HTML completo</option>
              <option>Markdown</option>
              <option>Texto plano</option>
              <option>Lista numerada</option>
              <option>Tabla</option>
            </select>
          </div>
          <div>
            <label for="length">Longitud esperada</label>
            <select id="length">
              <option>Breve</option>
              <option selected>Media</option>
              <option>Larga</option>
              <option>L√≠mite 800 palabras</option>
            </select>
          </div>
        </div>
      </div>
      <div class="ilh-card">
        <label for="positive-example">Mini ejemplo de lo deseado (opcional)</label>
        <textarea id="positive-example" placeholder="Ej.: Integrar secci√≥n con t√≠tulos H2, respetar clases y comentar ES/EN..."></textarea>
        <label for="negative-example">Qu√© NO hacer (opcional)</label>
        <textarea id="negative-example" placeholder="Ej.: No eliminar el banner de cookies ni mover el bot√≥n de comentarios..."></textarea>
      </div>
    </div>
  </section>

  <!-- ===============================
       3) Reglas duras (palomitas)
       =============================== -->
  <section class="ilh-card ilh-full">
    <h2>3) Reglas duras (marca con palomita)</h2>
    <div class="ilh-grid">
      <div class="ilh-card">
        <div class="ilh-checks" id="hard-rules-left">
          <label><input type="checkbox" class="hr" value="No modificar ni eliminar header, men√∫ lateral (drawer), bot√≥n de comentarios (utterances), footer ni banner de cookies." checked> No tocar header/drawer/utterances/footer/cookies.</label>
          <label><input type="checkbox" class="hr" value="Mantener la uniformidad del sitio (clases y animaciones existentes)."> Mantener clases/animaciones existentes.</label>
          <label><input type="checkbox" class="hr" value="Encapsular nuevos estilos con prefijo .ilh- o dentro de [data-scope=&quot;ilh&quot;]." checked> Encapsular estilos con <code>.ilh-</code> o <code>[data-scope="ilh"]</code>.</label>
          <label><input type="checkbox" class="hr" value="Garantizar HTML v√°lido (W3C) y accesible; usar IDs √∫nicos y alt en im√°genes." checked> HTML v√°lido + accesibilidad + IDs √∫nicos.</label>
          <label><input type="checkbox" class="hr" value="Compatibilidad responsive en PC y m√≥viles sin librer√≠as externas nuevas."> Responsive sin librer√≠as nuevas.</label>
        </div>
      </div>
      <div class="ilh-card">
        <div class="ilh-checks" id="hard-rules-right">
          <label><input type="checkbox" class="hr" value="Evitar sobrescribir variables globales o estilos base del sitio." checked> No sobrescribir variables/globales.</label>
          <label><input type="checkbox" class="hr" value="Comentarios biling√ºes ES/EN en el c√≥digo entregado."> Comentarios biling√ºes ES/EN.</label>
          <label><input type="checkbox" class="hr" value="Sanitizar/escapar scripts dentro del contenido si viene como texto." checked> Sanitizar scripts en contenido de texto.</label>
          <label><input type="checkbox" class="hr" value="No insertar iframes externos sin aviso; marcar como &quot;requiere revisi√≥n&quot;."> Iframes externos: marcar ‚Äúrequiere revisi√≥n‚Äù.</label>
          <label><input type="checkbox" class="hr" value="Evitar estilos inline salvo justificaci√≥n expl√≠cita." > Evitar estilos inline.</label>
        </div>
      </div>
    </div>
    <div class="ilh-badges">
      <span class="ilh-badge">‚úî Reglas duras = el modelo NO las negocia</span>
      <span class="ilh-badge">‚úî Se reflejan tal cual en el prompt</span>
    </div>
  </section>

  <!-- ===============================
       4) Presets y acciones
       =============================== -->
  <section class="ilh-card ilh-full">
    <h2>4) Presets y acciones</h2>
    <div class="ilh-row">
      <div class="ilh-row" style="flex:2">
        <div>
          <label for="preset">Preset</label>
          <select id="preset">
            <option value="custom" selected>‚Äî Personalizado ‚Äî</option>
            <option value="html_puro">Insertar HTML puro</option>
            <option value="informe_academico">Informe acad√©mico</option>
            <option value="pagina_marketing">P√°gina r√°pida marketing</option>
          </select>
        </div>
        <div>
          <label for="preset-name">Nombre para guardar preset</label>
          <input id="preset-name" type="text" placeholder="Ej.: Trabajo SO v1"/>
        </div>
      </div>
      <div class="ilh-actions">
        <button id="apply-preset" class="secondary">Aplicar preset</button>
        <button id="save-preset" class="secondary">Guardar preset</button>
        <button id="generate-btn">üî® Generar Prompt</button>
        <button id="copy-prompt-btn" class="ok" style="display:none;">üìã Copiar Prompt</button>
        <span id="copy-status" class="ilh-ok" style="display:none;">‚úÖ Copiado</span>
      </div>
    </div>
    <p class="ilh-note">ES: Los presets se guardan en <em>localStorage</em> del navegador. | EN: Presets persist in browser localStorage.</p>
  </section>

  <!-- ===============================
       5) Vista previa del prompt
       =============================== -->
  <section class="ilh-card ilh-full">
    <h2>5) Vista previa del Prompt</h2>
    <div id="prompt-preview" class="ilh-preview">Genera el prompt para verlo aqu√≠‚Ä¶</div>
  </section>

  <!-- ===============================
       6) Checklist final
       =============================== -->
  <section class="ilh-card ilh-full">
    <h2>6) Checklist autom√°tico</h2>
    <ul id="auto-checklist">
      <li>1) Plantilla presente: <span id="chk-template" class="ilh-chip">pendiente</span></li>
      <li>2) Contenido presente: <span id="chk-content" class="ilh-chip">pendiente</span></li>
      <li>3) Selector de inserci√≥n: <span id="chk-selector" class="ilh-chip">pendiente</span></li>
      <li>4) Reglas duras marcadas: <span id="chk-rules" class="ilh-chip">pendiente</span></li>
      <li>5) Contexto del encargo: <span id="chk-context" class="ilh-chip">pendiente</span></li>
    </ul>
  </section>
</main>

<script>
  // ===============================
  // Utilidades
  // ===============================
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));

  function convertTextToHTML(text){
    // ES: Convierte texto plano a p√°rrafos HTML simples.
    // EN: Convert plain text to simple HTML paragraphs.
    const safe = text
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;');
    const chunks = safe.trim().split(/\n{2,}/).map(p => `<p>${p.replace(/\n/g,'<br/>')}</p>`);
    return `<section data-scope="ilh">\n${chunks.join('\n')}\n</section>`;
  }

  function wrapAcademicStructure(contentHTML){
    return `
<section class="pane" data-scope="ilh">
  <article>
    <h2>Introducci√≥n</h2>
    <p><!-- ES: Agrega una introducci√≥n; EN: Add an introduction --></p>

    <h2>Desarrollo</h2>
    ${contentHTML}

    <h2>Conclusiones</h2>
    <p><!-- ES: Sintetiza puntos clave; EN: Summarize key points --></p>

    <h2>Referencias</h2>
    <p><!-- ES: A√±ade referencias (APA breve); EN: Add brief APA references --></p>
  </article>
</section>`.trim();
  }

  function getCheckedRules(){
    return $$('.hr').filter(i=>i.checked).map(i=>i.value);
  }

  function summarizeRules(rules){
    return rules.length ? '‚Ä¢ ' + rules.join('\n‚Ä¢ ') : '‚Äî';
  }

  function short(value, fallback='‚Äî'){
    return (value||'').trim() ? value.trim() : fallback;
  }

  function updateChecklist(){
    $('#chk-template').textContent = $('#template-input').value.trim() ? 'ok' : 'pendiente';
    $('#chk-content').textContent  = $('#content-input').value.trim() ? 'ok' : 'pendiente';
    $('#chk-selector').textContent = $('#insertion-selector').value.trim() ? 'ok' : 'pendiente';
    const rulesOK = getCheckedRules().length >= 3;
    $('#chk-rules').textContent    = rulesOK ? 'ok' : 'pendiente';
    const ctxOK = $('#goal').value.trim() || $('#audience').value.trim();
    $('#chk-context').textContent  = ctxOK ? 'ok' : 'pendiente';
  }

  // ===============================
  // Presets b√°sicos
  // ===============================
  const builtInPresets = {
    html_puro: {
      structure:'no', tone:'Directo y t√©cnico', format:'HTML completo', length:'Breve',
      rules:['Mantener la uniformidad del sitio (clases y animaciones existentes).','Encapsular nuevos estilos con prefijo .ilh- o dentro de [data-scope="ilh"].','Garantizar HTML v√°lido (W3C) y accesible; usar IDs √∫nicos y alt en im√°genes.']
    },
    informe_academico: {
      structure:'yes', tone:'Formal docente', format:'HTML completo', length:'Larga',
      rules:['No modificar ni eliminar header, men√∫ lateral (drawer), bot√≥n de comentarios (utterances), footer ni banner de cookies.','Comentarios biling√ºes ES/EN en el c√≥digo entregado.','Evitar sobrescribir variables globales o estilos base del sitio.']
    },
    pagina_marketing: {
      structure:'no', tone:'Marketing persuasivo', format:'HTML completo', length:'Media',
      rules:['Mantener la uniformidad del sitio (clases y animaciones existentes).','No insertar iframes externos sin aviso; marcar como "requiere revisi√≥n".','Evitar estilos inline salvo justificaci√≥n expl√≠cita.']
    }
  };

  function applyPresetData(p){
    if(!p) return;
    $('#structure').value = p.structure || 'no';
    $('#tone').value      = p.tone || 'Neutro';
    $('#format').value    = p.format || 'HTML completo';
    $('#length').value    = p.length || 'Media';

    // Desmarcar todo y marcar los del preset
    $$('.hr').forEach(c=>c.checked=false);
    (p.rules||[]).forEach(v=>{
      const box = $$('.hr').find(c=>c.value===v);
      if(box) box.checked = true;
    });
    updateChecklist();
  }

  // LocalStorage helpers
  function saveCustomPreset(name){
    if(!name.trim()){ alert('Pon un nombre para el preset.'); return; }
    const data = {
      structure: $('#structure').value,
      tone: $('#tone').value,
      format: $('#format').value,
      length: $('#length').value,
      rules: getCheckedRules()
    };
    localStorage.setItem('ilh-preset-'+name, JSON.stringify(data));
    alert('Preset guardado: ' + name);
  }

  function loadCustomPreset(name){
    const raw = localStorage.getItem('ilh-preset-'+name);
    if(!raw){ alert('No existe preset con ese nombre.'); return; }
    applyPresetData(JSON.parse(raw));
  }

  // ===============================
  // Generaci√≥n del Prompt
  // ===============================
  let lastPrompt = '';

  function buildPrompt(){
    const template = $('#template-input').value;
    const contentRaw = $('#content-input').value;
    const contentType = $('#content-type').value;
    const structure = $('#structure').value;
    const insertionSelector = $('#insertion-selector').value;

    const goal = $('#goal').value;
    const audience = $('#audience').value;
    const tone = $('#tone').value;
    const format = $('#format').value;
    const length = $('#length').value;
    const posEx = $('#positive-example').value;
    const negEx = $('#negative-example').value;

    // Validaciones m√≠nimas
    if(!template.trim()){ alert('Falta la plantilla base.'); return ''; }
    if(!contentRaw.trim()){ alert('Falta el contenido del proyecto.'); return ''; }
    if(!insertionSelector.trim()){ alert('Falta el selector de inserci√≥n.'); return ''; }

    // Integraci√≥n de contenido
    let integratedContent = (contentType === 'text') ? convertTextToHTML(contentRaw) : contentRaw;
    if(structure === 'yes'){
      integratedContent = wrapAcademicStructure(integratedContent);
    }

    const hardRules = getCheckedRules();
    const hardRulesSummary = summarizeRules(hardRules);

    const prompt =
`üìù Prompt Maestro para integraci√≥n de contenido en plantilla base
________________________________________
Prop√≥sito / Purpose:
- ES: ${short(goal,'Integrar contenido en plantilla base sin romper estructura.')}
- EN: ${short(goal,'Integrate project content into the base template without breaking structure.')}

Audiencia / Audience: ${short(audience,'Mixto / General')}
Tono / Tone: ${tone}
Formato de salida / Output format: ${format}
Longitud / Length: ${length}
Selector de inserci√≥n permitido / Allowed insertion selector: "${insertionSelector}"

‚öôÔ∏è Condiciones obligatorias (no negociables) / Hard rules:
${hardRulesSummary}

Notas de calidad / Quality constraints:
- ES: Mantener accesibilidad (IDs √∫nicos, alt en im√°genes); conservar clases/animaciones existentes; no sobrescribir variables globales; evitar estilos inline salvo justificaci√≥n; sanitizar scripts si el contenido viene como texto; iframes externos: marcar "requiere revisi√≥n".
- EN: Keep accessibility (unique IDs, alt on images); preserve existing classes/animations; do not override global variables; avoid inline styles unless justified; sanitize scripts if content comes as text; external iframes: mark as "requires review".

Zonas de edici√≥n / Edit scopes:
- ES: Solo modificar el contenido dentro del selector indicado. Ning√∫n otro bloque debe ser alterado.
- EN: Only modify content within the specified selector. No other block must be changed.

üîß Opciones seleccionadas / Selected options:
- Estructura acad√©mica: ${structure === 'yes' ? 'S√≠ / Yes' : 'No'}
- Tipo de contenido: ${contentType === 'text' ? 'Texto (convertir a HTML)' : 'HTML directo'}

‚úÖ Checklist que debes confirmar antes de devolver / Must confirm before delivering:
1) Header, drawer, utterances, footer, cookies intactos.
2) Inserci√≥n realizada √öNICAMENTE en "${insertionSelector}".
3) HTML v√°lido + accesible; sin IDs duplicados.
4) Estilos nuevos encapsulados (.ilh- o [data-scope="ilh"]).
5) Responsive funcional en PC y m√≥viles.
6) Comentarios ES/EN a√±adidos.

Ejemplo positivo (opcional) / Positive example (optional):
${short(posEx, '‚Äî')}

Qu√© NO hacer (opcional) / What NOT to do (optional):
${short(negEx, '‚Äî')}

üìÑ Contenido a integrar / Content to integrate:
${integratedContent}

üìÅ Plantilla HTML base / Base template:
${template}
`;
    return prompt;
  }

  // ===============================
  // Eventos UI
  // ===============================
  $$('#template-input, #content-input, #insertion-selector, #goal, #audience, #tone, #format, #length, #positive-example, #negative-example, #structure, #content-type'.replaceAll('#','.#')).forEach(()=>{});
  // (El hack anterior no afecta; actualizamos checklist en entradas clave)
  ['template-input','content-input','insertion-selector','goal','audience'].forEach(id=>{
    document.getElementById(id).addEventListener('input', updateChecklist);
  });
  $$('.hr').forEach(c=>c.addEventListener('change', updateChecklist));

  $('#apply-preset').addEventListener('click', ()=>{
    const val = $('#preset').value;
    if(val==='custom'){
      const name = prompt('Nombre de preset a cargar (guardado por ti):');
      if(name){ loadCustomPreset(name); }
    }else{
      applyPresetData(builtInPresets[val]);
    }
  });

  $('#save-preset').addEventListener('click', ()=>{
    const name = $('#preset-name').value || prompt('Nombre para el preset:');
    if(name){ saveCustomPreset(name); }
  });

  $('#generate-btn').addEventListener('click', ()=>{
    const prompt = buildPrompt();
    if(!prompt) return;
    lastPrompt = prompt;
    $('#prompt-preview').textContent = prompt;
    $('#copy-prompt-btn').style.display = 'inline-block';
    updateChecklist();
  });

  $('#copy-prompt-btn').addEventListener('click', ()=>{
    if(!lastPrompt){ alert('Primero genera el prompt.'); return; }
    navigator.clipboard.writeText(lastPrompt).then(()=>{
      const el = $('#copy-status');
      el.style.display = 'inline-block';
      setTimeout(()=> el.style.display='none', 1600);
    });
  });

  // Arranque
  updateChecklist();
</script>
</body>
</html>
